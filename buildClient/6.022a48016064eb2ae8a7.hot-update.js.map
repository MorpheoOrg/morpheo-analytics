{"version":3,"file":"6.022a48016064eb2ae8a7.hot-update.js","sources":["webpack:///src/client/js/business/user/sagas.js"],"sourcesContent":["/**\n * Copyright Morpheo Org. 2017\n *\n * contact@morpheo.co\n *\n * This software is part of the Morpheo project, an open-source machine\n * learning platform.\n *\n * This software is governed by the CeCILL license, compatible with the\n * GNU GPL, under French law and abiding by the rules of distribution of\n * free software. You can  use, modify and/ or redistribute the software\n * under the terms of the CeCILL license as circulated by CEA, CNRS and\n * INRIA at the following URL \"http://www.cecill.info\".\n *\n * As a counterpart to the access to the source code and  rights to copy,\n * modify and redistribute granted by the license, users are provided only\n * with a limited warranty  and the software's author,  the holder of the\n * economic rights,  and the successive licensors  have only  limited\n * liability.\n *\n * In this respect, the user's attention is drawn to the risks associated\n * with loading,  using,  modifying and/or developing or reproducing the\n * software by the user in light of its specific status of free software,\n * that may mean  that it is complicated to manipulate,  and  that  also\n * therefore means  that it is reserved for developers  and  experienced\n * professionals having in-depth computer knowledge. Users are therefore\n * encouraged to load and test the software's suitability as regards their\n * requirements in conditions enabling the security of their systems and/or\n * data to be ensured and,  more generally, to use and operate it in the\n * same conditions as regards security.\n *\n * The fact that you are presently reading this means that you have had\n * knowledge of the CeCILL license and that you accept its terms.\n */\n\n/* globals atob */\n\nimport {redirect} from 'redux-first-router';\nimport {call, put, takeLatest, all} from 'redux-saga/effects';\n\nimport {\n    signIn as signInActions,\n    signOut as signOutActions,\n    actionTypes,\n} from './actions';\nimport {actions as settingsActions} from '../settings/actions';\n\nimport {\n    fetchSignIn as fetchSignInApi,\n    removeLocalUser as removeLocalUserApi,\n    storeLocalUser as storeLocalUserApi,\n} from './api';\n\n\nconsole.log('load user sagas');\n\nexport const signIn = (fetchSignIn, storeLocalUser) =>\n    function* signInSaga({payload: {uuid, previousRoute}}) {\n\n        console.log('sagas');\n\n        const {error, res} = yield call(fetchSignIn, uuid);\n\n        if (error) {\n            console.error(error);\n            yield put(signInActions.failure(error));\n            // yield put(signInActions.failure(new Error('{\"message\": \"Unauthorized\"}')));\n        }\n        else {\n            const {settings, access_token} = res;\n            const {uuid} = JSON.parse(atob(access_token.split('.')[1]));\n\n            yield call(storeLocalUser, {uuid, settings, access_token});\n            yield put(signInActions.success({uuid}));\n            yield put(settingsActions.update(...settings));\n\n            yield put(redirect(previousRoute));\n        }\n    };\n\nexport const signOut = removeLocalUser =>\n    function* signOutSaga() {\n        yield call(removeLocalUser);\n        yield put(signOutActions.success());\n        // TODO should be handle in settings reducer\n        yield put(settingsActions.update({theme: null, preferred_language: null, keybindings: null}));\n\n        yield put(redirect({type: 'HOME'}));\n    };\n\n/* istanbul ignore next */\nconst sagas = function* sagas() {\n    yield all([\n        takeLatest(actionTypes.signIn.REQUEST, signIn(fetchSignInApi, storeLocalUserApi)),\n        takeLatest(actionTypes.signOut.REQUEST, signOut(removeLocalUserApi)),\n    ]);\n};\n\n\nexport default sagas;\n\n\n\n// WEBPACK FOOTER //\n// src/client/js/business/user/sagas.js"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAqCA;AACA;AAAA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;;;AAMA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAnBA;AACA;AAoBA;AAAA;AACA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAHA;AAAA;AACA;AADA;AAAA;AAIA;AAAA;AACA;AALA;AAAA;AAAA;AAAA;AACA;AAMA;AAPA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAYA;AAZA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AAAA;AACA;AAuBA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AAAA;AACA;AASA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAOA;;;;;;;;;;AA3CA;AACA;AAuBA;AACA;AAUA;AACA;;;;;;;;;;;;;;;;;;;A","sourceRoot":""}